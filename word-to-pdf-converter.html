<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word (DOCX) to PDF — Free Image Resizer</title>

  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <meta name="description" content="Convert DOCX (Word) documents to PDF client-side using Mammoth + html2pdf." />

  <!-- Global Site CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- Local Libraries (Do NOT modify names) -->
  <script src="libs/jszip.min.js"></script>
  <script src="libs/mammoth.browser.min.js"></script>
  <script src="libs/html2pdf.bundle.min.js"></script>

  <style>
    .convert-container {
      max-width: 1150px;
      margin: 30px auto;
      padding: 15px;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 25px;
      align-items: stretch;
    }
    @media (max-width:900px){
      .convert-container { grid-template-columns: 1fr; }
    }

    .convert-left {
      background:#131d32;
      padding:20px;
      border-radius:10px;
      border:1px solid #1d2944;
      height: 100%;
      display:flex;
      flex-direction:column;
    }

    .drop-area {
      background:#0f1829;
      border:1px dashed #1e2c47;
      padding:20px;
      border-radius:10px;
      color:#cfe9ff;
      text-align:center;
      cursor:pointer;
    }
    .drop-area.active {
      border-color:#4aa8ff;
      box-shadow:0 0 18px rgba(31,155,255,0.08);
    }

    .small-input {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #2b3b5a;
      background:#0f1829;
      color:#e8ecf4;
      margin-top:12px;
    }

    .generate-btn {
      width:100%;
      padding:12px;
      background:#1f9bff;
      color:white;
      border:none;
      border-radius:8px;
      cursor:pointer;
      margin-top:12px;
      font-size:16px;
    }

    .muted { color:#9fb1d6; font-size:13px; }

    .preview-box {
      background:#0f1829;
      border:1px solid #1d2944;
      padding:18px;
      border-radius:10px;
      min-height:360px;
      color:#dceeff;
      height:100%;
      overflow:auto;
    }

    .doc-preview {
      background:white;
      padding:24px;
      border-radius:6px;
      border:1px solid #d8dce6;
      color:#111;
      font-family:"Times New Roman", Georgia, serif;
      font-size:14px;
      line-height:1.45;
    }

    .hidden { display:none; }
  </style>
</head>

<body>

<!-- NAVBAR -->
<div id="navbar"></div>
<script>
fetch("components/navbar.html")
  .then(r => r.text())
  .then(html => {
    document.getElementById("navbar").innerHTML = html;
    const ham = document.getElementById("hamburger");
    const menu = document.getElementById("mobileMenu");
    if (ham && menu) ham.onclick = () => menu.classList.toggle("active");
  });
</script>

<header class="head" style="max-width:1150px;margin:18px auto 0;padding:0 15px;">
  <h1>Word → PDF Converter</h1>
  <p class="tagline">Fast & stable DOCX → PDF conversion — fully client-side.</p>
</header>

<div class="convert-container">

  <!-- LEFT PANEL -->
  <div class="convert-left">
    <h3 style="color:#7fc6ff;">Upload DOCX</h3>

    <div id="drop-area" class="drop-area">
      <h4>Drop .docx here</h4>
      <p class="muted">or click to browse</p>
      <input id="fileInput" type="file" accept=".docx" hidden>
    </div>

    <label class="muted" style="margin-top:15px;">Output Filename</label>
    <input id="outName" class="small-input" value="document.pdf">

    <label class="muted" style="margin-top:15px;">PDF DPI (Quality)</label>
    <input id="pdfScale" class="small-input" type="number" value="1" min="1" max="3" step="0.2">

    <button id="convertBtn" class="generate-btn" disabled>Convert to PDF</button>
    <button id="resetBtn" class="generate-btn" style="background:#6c757d;margin-top:8px;">Reset</button>

    <div id="statusText" class="muted" style="margin-top:12px;">No document loaded.</div>
  </div>

  <!-- RIGHT PREVIEW -->
  <div class="preview-box">
    <div id="docPreview" class="doc-preview hidden"></div>
    <div id="noPreview" class="muted">No document loaded.</div>
  </div>

</div>

<!-- FOOTER -->
<footer class="vertical-footer">
  <ul>
    <li><a href="about.html">About Us</a></li>
    <li><a href="privacy.html">Privacy Policy</a></li>
    <li><a href="terms.html">Terms of Service</a></li>
    <li><a href="contact.html">Contact</a></li>
    <li><a href="faq.html">FAQ</a></li>
  </ul>
  <p>© <span id="year"></span> Free Image Resizer — All Rights Reserved.</p>
</footer>
<script>document.getElementById("year").textContent = new Date().getFullYear();</script>

<script>
const dropArea = document.getElementById("drop-area");
const fileInput = document.getElementById("fileInput");
const docPreview = document.getElementById("docPreview");
const noPreview = document.getElementById("noPreview");
const convertBtn = document.getElementById("convertBtn");
const resetBtn = document.getElementById("resetBtn");
const statusText = document.getElementById("statusText");
const outName = document.getElementById("outName");
const pdfScale = document.getElementById("pdfScale");

let currentDocHtml = "";

/* CLICK TO OPEN FILE */
dropArea.onclick = () => fileInput.click();

/* FILE CHOSEN */
fileInput.onchange = () => {
  if (fileInput.files.length > 0) handleFile(fileInput.files[0]);
  fileInput.value = "";
};

/* DRAG EVENTS */
dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.classList.add("active"); });
dropArea.addEventListener("dragleave", () => dropArea.classList.remove("active"));
dropArea.addEventListener("drop", e => {
  e.preventDefault();
  dropArea.classList.remove("active");
  if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
});

/* HANDLE DOCX */
async function handleFile(file) {
  if (!file.name.endsWith(".docx")) { alert("Only .docx files supported."); return; }

  statusText.textContent = "Processing DOCX...";
  convertBtn.disabled = true;
  docPreview.classList.add("hidden");
  noPreview.classList.remove("hidden");

  try {
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.convertToHtml({ arrayBuffer });

    currentDocHtml = result.value;
    docPreview.innerHTML = currentDocHtml;

    docPreview.classList.remove("hidden");
    noPreview.classList.add("hidden");
    convertBtn.disabled = false;
    statusText.textContent = "Document loaded.";
  } 
  catch (err) {
    console.error(err);
    alert("Failed to read DOCX.");
    statusText.textContent = "Load failed.";
  }
}

/* PDF GENERATION */
convertBtn.onclick = async () => {
  if (!currentDocHtml) return;

  convertBtn.disabled = true;
  statusText.textContent = "Generating PDF...";

  try {
    const opt = {
      margin: 10,
      filename: outName.value || "document.pdf",
      html2canvas: { scale: Number(pdfScale.value) || 1, useCORS: true },
      jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
    };

    await html2pdf().set(opt).from(docPreview).save();

    statusText.textContent = "PDF downloaded.";
  } 
  catch (err) {
    console.error(err);
    alert("PDF generation failed.");
    statusText.textContent = "PDF failed.";
  }

  convertBtn.disabled = false;
};

/* RESET */
resetBtn.onclick = () => {
  currentDocHtml = "";
  docPreview.innerHTML = "";
  docPreview.classList.add("hidden");
  noPreview.classList.remove("hidden");
  convertBtn.disabled = true;
  statusText.textContent = "No document loaded.";
};
</script>

</body>
</html>

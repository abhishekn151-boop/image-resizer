<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Image → PDF Converter — Free Tools Hub</title>

  <!-- FIXED: favicon absolute path -->
  <link rel="icon" type="image/png" href="/assets/favicon.png" />

  <!-- FIXED: SEO description -->
  <meta name="description" content="Convert one or multiple images into a single high-quality PDF online, instantly and free." />

  <!-- FIXED: Global CSS absolute path -->
  <link rel="stylesheet" href="/style.css" />

  <!-- jsPDF (unchanged) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* LAYOUT LIKE IMAGE RESIZER */
    .pdf-container {
      max-width: 1150px;
      margin: 30px auto;
      padding: 15px;
      display: grid;
      grid-template-columns: 330px 1fr;
      gap: 25px;
    }
    @media (max-width:900px){
      .pdf-container {
        grid-template-columns: 1fr;
      }
    }

    .pdf-settings {
      background:#131d32;
      padding:20px;
      border:1px solid #1d2944;
      border-radius:10px;
      height: fit-content;
    }

    .thumbs-box {
      background:#0f1829;
      border:1px solid #1d2944;
      padding:15px;
      border-radius:10px;
      min-height:190px;
    }

    .thumb-list {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      min-height:160px;
    }

    .thumb {
      width:110px;
      padding:8px;
      border-radius:8px;
      background:#111a2e;
      border:1px solid #1e2c47;
      cursor:grab;
      text-align:center;
    }

    .thumb img {
      width:100%;
      height:70px;
      object-fit:cover;
      border-radius:6px;
      margin-bottom:6px;
    }

    .thumb.dragging {
      opacity:.4;
      transform:scale(.97);
    }

    .small-input {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #2b3b5a;
      background:#0f1829;
      color:#e8ecf4;
    }

    .generate-btn {
      width:100%;
      padding:12px;
      background:#1f9bff;
      color:white;
      border:none;
      border-radius:8px;
      cursor:pointer;
      margin-top:15px;
      font-size:16px;
    }
  </style>
</head>
<body>

<!-- TOP NAVIGATION BAR -->
<div id="navbar"></div>
<script>
  fetch("/components/navbar.html")   // FIXED: absolute path
    .then(r => r.text())
    .then(html => {
      document.getElementById("navbar").innerHTML = html;

      const ham = document.getElementById("hamburger");
      const menu = document.getElementById("mobileMenu");

      if (ham && menu) {
        ham.onclick = () => menu.classList.toggle("active");
      }
    });
</script>

<header class="head">
  <h1>Image to PDF Converter</h1>
  <p class="tagline">Upload multiple images and convert them into a single PDF in original quality.</p>
</header>

<!-- MAIN TOOL -->
<div class="pdf-container">

  <!-- SETTINGS -->
  <div class="pdf-settings">

    <h3 style="color:#7fc6ff;">Upload Images</h3>

    <div id="drop-area" class="drop-area" style="padding:20px; text-align:center;">
      <h3>Drop images here</h3>
      <p class="note-small">or click to browse</p>

      <!-- no change -->
      <input id="fileInput" type="file" accept="image/*" multiple hidden>
    </div>

    <h3 style="margin-top:25px; color:#7fc6ff;">Page Size</h3>
    <select class="small-input" id="pageSize">
      <option value="original">Original (no scaling)</option>
      <option value="a4">A4</option>
      <option value="letter">Letter</option>
      <option value="legal">Legal</option>
      <option value="custom">Custom</option>
    </select>

    <div id="customSizeRow" style="display:none; margin-top:10px;">
      <input id="customWidth" class="small-input" type="number" placeholder="Width">
      <input id="customHeight" class="small-input" type="number" placeholder="Height" style="margin-top:8px;">
      <select id="customUnit" class="small-input" style="margin-top:8px;">
        <option value="mm">mm</option>
        <option value="cm">cm</option>
        <option value="px">px</option>
      </select>
    </div>

    <h3 style="margin-top:25px; color:#7fc6ff;">Orientation</h3>
    <select id="orientation" class="small-input">
      <option value="portrait">Portrait</option>
      <option value="landscape">Landscape</option>
    </select>

    <button id="deleteSelectedBtn" class="generate-btn">Delete Selected</button>
    <button id="deleteAllBtn" class="generate-btn">Delete All</button>
    <button id="generateBtn" class="generate-btn">Generate PDF</button>

  </div>
  <!-- PREVIEW / THUMBNAILS -->
  <div class="thumbs-box">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
      <strong>Selected Images</strong>
      <span id="count" class="note-small">0 files</span>
    </div>

    <div id="thumbList" class="thumb-list"></div>
  </div>

</div> <!-- END .pdf-container -->


<!-- FOOTER -->
<footer class="vertical-footer">
  <ul>
    <li><a href="/about.html">About Us</a></li>
    <li><a href="/privacy.html">Privacy Policy</a></li>
    <li><a href="/terms.html">Terms of Service</a></li>
    <li><a href="/contact.html">Contact</a></li>
    <li><a href="/faq.html">FAQ</a></li>
  </ul>

  <p>© <span id="year"></span> Free Tools Hub — All Rights Reserved.</p>
</footer>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();
</script>
<script>
/* ----------------------------
   BASIC ELEMENTS
----------------------------- */
const { jsPDF } = window.jspdf;

const dropArea = document.getElementById("drop-area");
const fileInput = document.getElementById("fileInput");
const thumbList = document.getElementById("thumbList");
const countEl = document.getElementById("count");
const pageSizeEl = document.getElementById("pageSize");
const orientationEl = document.getElementById("orientation");
const customSizeRow = document.getElementById("customSizeRow");
const customWidth = document.getElementById("customWidth");
const customHeight = document.getElementById("customHeight");
const customUnit = document.getElementById("customUnit");
const generateBtn = document.getElementById("generateBtn");

let files = []; // { file, url, id, img }

/* ----------------------------
   FILE HANDLING
----------------------------- */
function handleFilesList(list) {
  const arr = Array.from(list);

  for (const file of arr) {
    if (!file.type.startsWith("image/")) continue;

    const id = Math.random().toString(36).slice(2, 9);
    const url = URL.createObjectURL(file);

    let item = { file, url, id, img: null };

    files.push(item);

    const img = new Image();
    img.onload = () => (item.img = img);
    img.src = url;
  }

  renderThumbs();
}

dropArea.addEventListener("click", () => fileInput.click());

fileInput.addEventListener("change", () => {
  handleFilesList(fileInput.files);
  fileInput.value = "";
});

dropArea.addEventListener("dragover", (e) => {
  e.preventDefault();
  dropArea.classList.add("active");
});

dropArea.addEventListener("dragleave", () => dropArea.classList.remove("active"));

dropArea.addEventListener("drop", (e) => {
  e.preventDefault();
  dropArea.classList.remove("active");
  handleFilesList(e.dataTransfer.files);
});

function updateCount() {
  countEl.textContent = files.length + " file" + (files.length === 1 ? "" : "s");
}

/* ----------------------------
   RENDER THUMBNAILS
----------------------------- */
function createThumb(item, index) {
  const div = document.createElement("div");
  div.className = "thumb";
  div.draggable = true;
  div.dataset.id = item.id;

  const topRow = document.createElement("div");
  topRow.style.display = "flex";
  topRow.style.justifyContent = "space-between";
  topRow.style.alignItems = "center";
  topRow.style.marginBottom = "6px";

  const numberBox = document.createElement("span");
  numberBox.textContent = index + 1;
  numberBox.style.background = "#273556";
  numberBox.style.color = "#dbefff";
  numberBox.style.fontSize = "12px";
  numberBox.style.padding = "2px 6px";
  numberBox.style.borderRadius = "6px";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.className = "select-checkbox";
  checkbox.dataset.id = item.id;

  topRow.appendChild(numberBox);
  topRow.appendChild(checkbox);

  const img = document.createElement("img");
  img.src = item.url;

  const name = document.createElement("div");
  name.style.fontSize = "12px";
  name.style.wordBreak = "break-word";
  name.textContent = item.file.name;

  const removeBtn = document.createElement("button");
  removeBtn.textContent = "Remove";
  removeBtn.style.marginTop = "6px";
  removeBtn.style.fontSize = "12px";
  removeBtn.style.padding = "6px";
  removeBtn.style.borderRadius = "6px";
  removeBtn.style.background = "#273556";
  removeBtn.style.color = "#dbefff";
  removeBtn.style.border = "none";
  removeBtn.style.cursor = "pointer";

  removeBtn.onclick = () => {
    files = files.filter((f) => f.id !== item.id);
    renderThumbs();
  };

  div.appendChild(topRow);
  div.appendChild(img);
  div.appendChild(name);
  div.appendChild(removeBtn);

  div.addEventListener("dragstart", () => div.classList.add("dragging"));
  div.addEventListener("dragend", () => div.classList.remove("dragging"));

  return div;
}

function renderThumbs() {
  thumbList.innerHTML = "";
  files.forEach((item, i) => {
    thumbList.appendChild(createThumb(item, i));
  });
  updateCount();
}

/* ----------------------------
   DRAG TO REORDER
----------------------------- */
thumbList.addEventListener("dragover", (e) => {
  e.preventDefault();

  const dragging = document.querySelector(".thumb.dragging");
  if (!dragging) return;

  const afterElement = getDragAfterElement(thumbList, e.clientX, e.clientY);

  if (afterElement == null) {
    thumbList.appendChild(dragging);
  } else {
    thumbList.insertBefore(dragging, afterElement);
  }

  files = [...thumbList.querySelectorAll(".thumb")].map(div =>
    files.find(f => f.id === div.dataset.id)
  );

  renderThumbs();
});

function getDragAfterElement(container, mouseX, mouseY) {
  const elements = [...container.querySelectorAll(".thumb:not(.dragging)")];

  return elements.reduce(
    (closest, child) => {
      const rect = child.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const distance = Math.hypot(mouseX - cx, mouseY - cy);

      if (distance < closest.distance) {
        return { distance, element: child };
      }
      return closest;
    },
    { distance: Infinity, element: null }
  ).element;
}

/* ----------------------------
   DELETE SELECTED
----------------------------- */
document.getElementById("deleteSelectedBtn").addEventListener("click", () => {
  const selected = [...document.querySelectorAll(".select-checkbox:checked")]
    .map(cb => cb.dataset.id);

  if (!selected.length) return alert("No images selected.");

  files = files.filter(f => !selected.includes(f.id));
  renderThumbs();
});

/* ----------------------------
   DELETE ALL
----------------------------- */
document.getElementById("deleteAllBtn").addEventListener("click", () => {
  if (!files.length) return;
  if (!confirm("Delete ALL images?")) return;
  files = [];
  renderThumbs();
});

/* ----------------------------
   PAGE SIZE UI
----------------------------- */
pageSizeEl.addEventListener("change", () => {
  customSizeRow.style.display =
    pageSizeEl.value === "custom" ? "block" : "none";
});

/* ----------------------------
   GENERATE PDF
----------------------------- */
generateBtn.addEventListener("click", async () => {
  if (!files.length) return alert("Please upload at least one image.");

  generateBtn.disabled = true;
  generateBtn.textContent = "Generating...";

  try {
    const docPages = [];

    for (let item of files) {
      const img = item.img;
      const orientation = orientationEl.value;

      if (!img) continue;

      if (pageSizeEl.value === "original") {
        docPages.push({
          width: img.naturalWidth,
          height: img.naturalHeight,
          image: img,
          orientation,
        });
      } else {
        let pageW, pageH;

        if (pageSizeEl.value === "a4") pageW = 210, pageH = 297;
        else if (pageSizeEl.value === "letter") pageW = 216, pageH = 279;
        else if (pageSizeEl.value === "legal") pageW = 216, pageH = 356;
        else {
          let W = Number(customWidth.value);
          let H = Number(customHeight.value);
          const unit = customUnit.value;

          if (unit === "cm") {
            W = W * 10;
            H = H * 10;
          }
          if (unit === "px") {
            const DPI = 96;
            W = (W / DPI) * 25.4;
            H = (H / DPI) * 25.4;
          }

          pageW = W;
          pageH = H;
        }

        const DPI = 96;
        const mmToPx = (mm) => Math.round((mm / 25.4) * DPI);

        let pxW = mmToPx(pageW), pxH = mmToPx(pageH);

        if (orientation === "landscape") [pxW, pxH] = [pxH, pxW];

        const scale = Math.min(pxW / img.naturalWidth, pxH / img.naturalHeight, 1);

        docPages.push({
          width: pxW,
          height: pxH,
          image: img,
          drawW: img.naturalWidth * scale,
          drawH: img.naturalHeight * scale,
          orientation,
        });
      }
    }

    const first = docPages[0];
    const doc = new jsPDF({ unit: "px", format: [first.width, first.height] });

    for (let i = 0; i < docPages.length; i++) {
      const p = docPages[i];
      if (i > 0) doc.addPage([p.width, p.height], p.orientation);

      const c = document.createElement("canvas");
      c.width = p.image.naturalWidth;
      c.height = p.image.naturalHeight;

      const ctx = c.getContext("2d");
      ctx.drawImage(p.image, 0, 0);

      const dataURL = c.toDataURL("image/jpeg", 1.0);
      const x = (p.width - (p.drawW || p.width)) / 2;
      const y = (p.height - (p.drawH || p.height)) / 2;

      doc.addImage(dataURL, "JPEG", x, y, p.drawW || p.width, p.drawH || p.height);
    }

    doc.save("images.pdf");

  } catch (err) {
    console.error(err);
    alert("Failed to generate PDF.");
  }

  generateBtn.disabled = false;
  generateBtn.textContent = "Generate PDF";
});
</script>

</body>
</html>
